<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/2356874721.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/2356874721.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/2356874721.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/2356874721.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/2356874721.github.io/css/main.css">


<link rel="stylesheet" href="/2356874721.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/2356874721.github.io/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="警长的博客">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="警长的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="sheriff">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>警长的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/2356874721.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">警长的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录生活 记录成长</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/2356874721.github.io/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/2356874721.github.io/archives/" rel="section"><i class="archives fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/2356874721.github.io/categories/" rel="section"><i class="categories fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/2356874721.github.io/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/2356874721.github.io/about/" rel="section"><i class="about fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/18/js-symbol/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/18/js-symbol/" class="post-title-link" itemprop="url">Symbol</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-18 10:36:25" itemprop="dateCreated datePublished" datetime="2020-07-18T10:36:25+08:00">2020-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="symbol是什么"><a href="#symbol是什么" class="headerlink" title="symbol是什么"></a>symbol是什么</h2><p>Symbol是一种基础数据类型，你可以通过如下方式创建一个Symbol类型，至此js基本数据类型有如下几种：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">number | string | boolean | <span class="literal">undefined</span> | <span class="literal">null</span> | <span class="built_in">Symbol</span></span><br></pre></td></tr></table></figure>

<p>引用类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span></span><br></pre></td></tr></table></figure>

<h2 id="创建Symbol"><a href="#创建Symbol" class="headerlink" title="创建Symbol"></a>创建Symbol</h2><p>你可以通过如下方式创建一个Symbol类型，这里面参数指的是变量的描述信息，没有实际的意义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="built_in">Symbol</span>(<span class="string">'sheriff'</span>)</span><br></pre></td></tr></table></figure>

<p>因为它是一种新的数据类型，所以可以通过typeof 来检查类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> name ==&gt; <span class="string">'symbol'</span></span><br></pre></td></tr></table></figure>

<h2 id="Symbol的特点"><a href="#Symbol的特点" class="headerlink" title="Symbol的特点"></a>Symbol的特点</h2><p>•每一个Symbol实例都是唯一的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name1 = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">let</span> name2 = <span class="built_in">Symbol</span>(<span class="string">'lee'</span>)</span><br><span class="line"><span class="keyword">let</span> name3 = <span class="built_in">Symbol</span>(<span class="string">'lee'</span>)</span><br><span class="line">name1 === name2 ==&gt; <span class="literal">false</span></span><br><span class="line">name2 === name3 ==&gt; <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>•Symbol不能使用new关键字</p>
<p>•Symbol不支持强制类型转换</p>
<h2 id="Symbol应用场景"><a href="#Symbol应用场景" class="headerlink" title="Symbol应用场景"></a>Symbol应用场景</h2><h3 id="对象属性名"><a href="#对象属性名" class="headerlink" title="对象属性名"></a>对象属性名</h3><p>当一个复杂对象中含有多个属性的时候，很容易将某个属性名覆盖掉，利用 Symbol 值作为属性名可以很好的避免这一现象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Name = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> Age = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  [Name]: <span class="string">'sheriff'</span>,</span><br><span class="line">  [Age]: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line">obj[Name] ==&gt; sheriff</span><br><span class="line">obj[Age] ==&gt; <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p> <strong>注意：</strong>就是当使用了Symbol作为对象的属性key后，在对该对象进行key的枚举时，用Object.keys()或者for…in来枚举对象的属性名，是取不到Symbol类型的属性的</p>
<p><strong>解决方式</strong>：使用这两种方式可以取到Symbol属性的值 Object.getOwnPropertySymbols(obj)、Reflect.ownKeys(obj)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertySymbols(obj).map(<span class="function"><span class="params">index</span> =&gt;</span> obj[index]) ==&gt; [<span class="string">'sheriff'</span>,<span class="number">20</span>]</span><br><span class="line"><span class="built_in">Reflect</span>.ownKeys(obj).map(<span class="function"><span class="params">index</span> =&gt;</span> obj[index]) ==&gt; [<span class="string">'sheriff'</span>,<span class="number">20</span>]</span><br></pre></td></tr></table></figure>

<h3 id="使用Symbol来替代常量"><a href="#使用Symbol来替代常量" class="headerlink" title="使用Symbol来替代常量"></a>使用Symbol来替代常量</h3><p>良好的代码风格应该尽量消除魔法字符串，而由含义清晰的变量代替。魔法字符串：指的是在代码之中多次出现、与代码形成强耦合的某一个具体的字符串或数值。如下代码中type_audio、type_video、type_image就是魔法字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TYPE_AUDIO = <span class="string">'type_audio'</span></span><br><span class="line"><span class="keyword">const</span> TYPE_VIDEO = <span class="string">'type_video'</span></span><br><span class="line"><span class="keyword">const</span> TYPE_IMAGE = <span class="string">'type_image'</span></span><br><span class="line"><span class="keyword">switch</span>()&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'type_audio'</span>:</span><br><span class="line">    ...do something</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'type_video'</span>:</span><br><span class="line">    ...do something</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'type_image'</span></span><br><span class="line">    ...do something</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消除魔法字符窜可以让代码更加优雅</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TYPE_AUDIO = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> TYPE_VIDEO = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> TYPE_IMAGE = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">switch</span>()&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'TYPE_AUDIO'</span>:</span><br><span class="line">    ...do something</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'TYPE_VIDEO'</span>:</span><br><span class="line">    ...do something</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'TYPE_IMAGE'</span></span><br><span class="line">    ...do something</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="定义类的私有属性和方法"><a href="#定义类的私有属性和方法" class="headerlink" title="定义类的私有属性和方法"></a>定义类的私有属性和方法</h3><p>在文件a.js中有一个Login类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PASSWORD = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(username, password) &#123;</span><br><span class="line">    <span class="keyword">this</span>.username = username</span><br><span class="line">    <span class="keyword">this</span>[PASSWORD] = password</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  checkPassword(pwd) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>[PASSWORD] === pwd</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Login</span><br></pre></td></tr></table></figure>

<p>b.js引入Login</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'./a.js'</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="keyword">new</span> Login(<span class="string">'admin'</span>, <span class="string">'123456'</span>)</span><br><span class="line">login.checkPassword(<span class="string">'123456'</span>) ==&gt; <span class="literal">true</span></span><br><span class="line">login.PASSWORD  ==&gt; 报错</span><br><span class="line">login[PASSWORD]  ==&gt; 报错</span><br><span class="line">login[<span class="string">"PASSWORD"</span>]  ==&gt; 报错</span><br></pre></td></tr></table></figure>

<p>用Symbol定义的属性PASSWORD，在b.js中调用a.js的方法使用，直接访问a.js中的PASSWORD属性是访问不到的，但是a.js内部可以访问到</p>
<h3 id="注册和获取全局Symbol"><a href="#注册和获取全局Symbol" class="headerlink" title="注册和获取全局Symbol"></a>注册和获取全局Symbol</h3><p>我们知道Symbol是唯一的，那么我们可以在全局中共用一个Symbol吗</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person1 = <span class="built_in">Symbol</span>.for(<span class="string">'person1'</span>)  </span><br><span class="line"><span class="keyword">let</span> person2 = <span class="built_in">Symbol</span>.for(<span class="string">'person1'</span>) </span><br><span class="line">person1 === person2  ==&gt; <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = <span class="built_in">Symbol</span>.for(<span class="string">'person1'</span>)</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(person1) ==&gt; <span class="string">'person1'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="built_in">Symbol</span>.keyFor(person2) ==&gt; <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/15/css-holygrail-twinwing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/" class="post-title-link" itemprop="url">圣杯布局、双飞翼布局</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-15 20:25:39" itemprop="dateCreated datePublished" datetime="2020-07-15T20:25:39+08:00">2020-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、圣杯的由来"><a href="#一、圣杯的由来" class="headerlink" title="一、圣杯的由来"></a>一、圣杯的由来</h2><p>圣杯最早出现在公元前33年，是耶稣受难前逾越节的晚餐上，耶稣与众门徒使用的一个葡萄酒的杯子。</p>
<p>相传以色列人在埃及受尽苦役，上帝耶和华召见摩西，让其带领以色列人逃离埃及，前往迦南美地。摩西召见以色列的长老们前来，告诉他们：你们要按照家口取出羊羔，在逾越节这天把羊羔宰了，拿一把牛膝草，蘸盆里的血，打在门楣上和左右的门框上，并且谁也不可出自己的房门，一直到早晨。因为<a href="https://baike.baidu.com/item/耶和华" target="_blank" rel="noopener">耶和华</a>要巡行击杀埃及人，他看见血在门楣上和左右的门框上，就必越过那门，不会进你们的房屋。日后，你们到了迦南美地，也要遵守这个礼仪，如果你们的儿女问你们说：‘行这礼是甚么意思？’你们就说：‘这是献给耶和华逾越节的祭。当年以色列人在埃及的时候，耶和华要击杀埃及人，通过门楣上的血，越过以色列人的房屋，救了我们各家。’”</p>
<p>传说耶稣受难就是为了在逾越节这一天，给上帝耶和华献祭，从此以色列人就再也不必宰杀羔羊。在耶稣受难后的第三天，耶稣复活，这也是复活节的由来。后来人就认为耶稣在受难前使用的那个杯子有一种神奇的能力，如果找到这个杯子，喝下杯子里面的水，就能返老还童、死而复生并且获得永生，这就是传说中的圣杯。</p>
<h2 id="二、圣杯布局"><a href="#二、圣杯布局" class="headerlink" title="二、圣杯布局"></a>二、圣杯布局</h2><p>言归正传进入正题，通过上面的小故事，有助于我们很好的理解到底什么是圣杯布局。你可以简单的理解为这种布局像圣杯的形象一样，分为中间的杯身主体和左右两边的杯把儿，即它是一个三列布局，遵循左右两端固定中间自适应的原则。具体遵循的原则有以下几点：</p>
<p>• 头部和足部占屏幕所有宽度</p>
<p>• 头、足之间是一个三列布局</p>
<p>• 三列布局中两侧宽度固定，中间自适应</p>
<p>• 允许三列中的任意一列最高，即头足之间的高度由三列中的最高一列的高度决定</p>
<p>• 中间一列要求在浏览器中最先渲染(内容区最重要，是用户最想看见的部分)</p>
<p>接下来它的具体实现方式：</p>
<h3 id="建立上、中、下基本结构"><a href="#建立上、中、下基本结构" class="headerlink" title="建立上、中、下基本结构"></a>建立上、中、下基本结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="加入中间三列"><a href="#加入中间三列" class="headerlink" title="加入中间三列"></a>加入中间三列</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在未加样式之前，页面是这个样子的：header、footer已经在预定位置，center、left、right在中间，接下来要做的就是把center、left、right按照中、左、右的顺序放置。</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/1.png" class>

<h3 id="加入浮动样式"><a href="#加入浮动样式" class="headerlink" title="加入浮动样式"></a>加入浮动样式</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span> &gt; <span class="selector-tag">div</span>&#123;</span><br><span class="line">	<span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时发现.content内部浮动，内部元素脱离文档流，.content的位置释放掉了，导致footer挤上去了，所以要给.footer加清除浮动</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.footer</span>&#123;</span><br><span class="line">	<span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来设置两侧宽度，以及预留两侧的空间</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>,<span class="selector-class">.right</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">	<span class="attribute">padding</span>: <span class="number">0</span> <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时页面样式如下：</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/2.png" class>

<h3 id="将left放到指定位置"><a href="#将left放到指定位置" class="headerlink" title="将left放到指定位置"></a>将left放到指定位置</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">	<span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/3.png" class>

<p>这时你一定会有疑问，设置margin-left:-100%之后，left为什么上去了？？是啊，我也一样，仔细思考了下，终于明白了这是为什么，请往下看。</p>
<p>首先要明确一点，margin-left:-100%，这个百分比是相对于谁的？答案是父元素。没错，不管是margin还是padding，百分比都是相对于父元素的width，注意一定是width哦，不是height什么的。搞清楚这一点你是不是就明白上面的问题了呢？left元素从下面移到上面，正好是一个content的宽度啊！！！</p>
<p>接下来的问题就简单了，再把left向左移动自身宽度就到达指定位置了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/4.png" class>

<h3 id="将right放到指定位置"><a href="#将right放到指定位置" class="headerlink" title="将right放到指定位置"></a>将right放到指定位置</h3><p>同样利用负外边距来实现</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/5.png" class>

<p>将right移动到指定位置还有另外一种写法：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">	<span class="attribute">margin-right</span>: -<span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，圣杯布局就完成了，此时是不是感觉岁月静好，仔细思考下，上面的思路是不是还不够完善。试想一下，两侧宽度是固定的，当屏幕足够小的时候，中间的内容区是不是会被挤没了，因此要设置一个最小宽度，来保证中间最为重要的内容区可以被用户看到。最小宽度的算法如下：<br>$$<br>minWidth = leftWidth * 2 + rightWidth<br>$$<br>看到这里，你是不是又感到一片迷茫呢?最小宽度不就是两个侧边栏的width之和就行了吗？2倍是什么鬼啊？ 请把我们的思绪往前倒一倒，还记得我们为了让left到指定位置，给它加了position:relative吗？如下图，就是我们设置了margin-left:-100%之后的位置，也就是相对定位的起始位置，正是由于relative没有脱离文档流，即时它移走了，但位置依然保留。</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/6.png" class>

<p>所以在left向左移动300px之后，它的位置依然在，你可以想象成下图的样子，红框就是left的原本位置，这个位置依然属于left，谁也抢不走。</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/7.png" class>

<p>当页面缩放到下面这个程度时，即left原本位置同center等宽的时候，这个时候就是页面的最小宽度了，如果页面宽度再小，left本身宽度+原本位置宽度+right宽度页面就放不下了，浮动元素就会发生换行，从而布局就被破坏了。</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/8.png" class>

<h2 id="双飞翼布局"><a href="#双飞翼布局" class="headerlink" title="双飞翼布局"></a>双飞翼布局</h2><p>双飞翼布局的提出，就是为了解决圣杯布局中不设置最小宽度布局混乱的问题，而直接导致页面这个问题的原因，就是设置相对定位导致的，因此双飞翼布局就抛弃掉了相对定位的方式。首先来看下双飞翼布局的结构，它的基本结构与圣杯布局的基本结构一样，区别在于对于内容区中间三列的处理。</p>
<h3 id="加入中间三列-1"><a href="#加入中间三列-1" class="headerlink" title="加入中间三列"></a>加入中间三列</h3><p>center增加一个包裹层</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center-wrap item"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left item"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right item"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="加入样式"><a href="#加入样式" class="headerlink" title="加入样式"></a>加入样式</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: bisque;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrap</span> <span class="selector-tag">div</span>&#123;</span><br><span class="line">	<span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> <span class="selector-class">.item</span>&#123;</span><br><span class="line">	<span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header</span>,<span class="selector-class">.footer</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: brown;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: blueviolet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.center-wrap</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: orange;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.center</span>&#123;</span><br><span class="line">	<span class="attribute">margin</span>: <span class="number">0</span> <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.footer</span>&#123;</span><br><span class="line">	<span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上将left、right移动到指定位置，同圣杯布局一致。不同之处在于，圣杯布局利用.content的padding来预留两侧栏的位置，而双飞翼是利用.center-wrap的外边距来预留位置。</p>
<h2 id="flex方式"><a href="#flex方式" class="headerlink" title="flex方式"></a>flex方式</h2><p>除了浮动，我们还可以利用flex来实现这种类似布局，当然这种实现方式可能违背了优先渲染中间区域的原则，但是原理比较简单，没有最小宽度的问题，在开发中也可以是很好的选择。</p>
<p>页面的基本结构与浮动方式一模一样，不同的地方在于，中间三列我们按照left、center、right的顺序放置如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置为三列设置的样式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">	<span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>,<span class="selector-class">.right</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.center</span>&#123;</span><br><span class="line">	<span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="grid方式"><a href="#grid方式" class="headerlink" title="grid方式"></a>grid方式</h2><p>这种方式目前对浏览器的兼容还不够好，但也介绍一下，开阔下视野，多知道点儿东西没有坏处。</p>
<h3 id="基础结构"><a href="#基础结构" class="headerlink" title="基础结构"></a>基础结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="加入样式-1"><a href="#加入样式-1" class="headerlink" title="加入样式"></a>加入样式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">.wrap&#123;</span><br><span class="line">  background-color: bisque;</span><br><span class="line">  height: 400px;</span><br><span class="line">  display: grid;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">.content&#123;</span><br><span class="line">  grid-row:2;</span><br><span class="line">  grid-column:1&#x2F;5;</span><br><span class="line">  display: grid;</span><br><span class="line">  grid-template-columns: 300px auto 300px;</span><br><span class="line">&#125;</span><br><span class="line">.left&#123;</span><br><span class="line">	background-color: blueviolet;</span><br><span class="line">&#125;</span><br><span class="line">.right&#123;</span><br><span class="line">	background-color: green;</span><br><span class="line">&#125;</span><br><span class="line">.center&#123;</span><br><span class="line">	background-color: orange;</span><br><span class="line">&#125;</span><br><span class="line">.header,.footer&#123;</span><br><span class="line">	background-color: brown;</span><br><span class="line">&#125;</span><br><span class="line">.header&#123;</span><br><span class="line">  grid-row:1;</span><br><span class="line">  grid-column:1&#x2F;5;</span><br><span class="line">&#125;</span><br><span class="line">.footer&#123;</span><br><span class="line">  grid-row:3;</span><br><span class="line">  grid-column:1&#x2F;5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终实现的效果如下图：</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/9.png" class>

<p>display:grid: 声明其内部元素遵循grid网格布局，加到父元素身上</p>
<p>grid-row:2: 占据父元素的第二行，加到子元素身上</p>
<p>grid-column:1/5: 占据父元素中的第一个格到第五个格子</p>
<p>grid-template-columns: 300px auto 300px: 内部元素每列的尺寸，即left=300px;right=300px，剩下的就是center的尺寸</p>
<p>关于网格可以在进一步解释下，grid-column:1/5中的1/5不是5份里面占1份的意思，而是从第一个格子到第五个格子，你可以简单的理解为是网格线的索引，只不过这个索引是从1开始的，如下图所示就是从【1】到【5】之间的部分。</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/10.png" class>

<h2 id="table方式"><a href="#table方式" class="headerlink" title="table方式"></a>table方式</h2><h3 id="基础结构-1"><a href="#基础结构-1" class="headerlink" title="基础结构"></a>基础结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="加入样式-2"><a href="#加入样式-2" class="headerlink" title="加入样式"></a>加入样式</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: bisque;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrap</span> <span class="selector-tag">div</span>&#123;</span><br><span class="line">	<span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> <span class="selector-tag">div</span>&#123;</span><br><span class="line">	<span class="attribute">display</span>: table-cell;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header</span>,<span class="selector-class">.footer</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: brown;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: blueviolet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.center</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="absolute方式"><a href="#absolute方式" class="headerlink" title="absolute方式"></a>absolute方式</h2><p>主要区别是在中间内容区域的处理上，利用绝对定位，来把left和right放到指定位置</p>
<h3 id="基础结构-2"><a href="#基础结构-2" class="headerlink" title="基础结构"></a>基础结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="加入样式-3"><a href="#加入样式-3" class="headerlink" title="加入样式"></a>加入样式</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: bisque;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrap</span> <span class="selector-tag">div</span>&#123;</span><br><span class="line">	<span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header</span>,<span class="selector-class">.footer</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>: brown;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: blueviolet;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.center</span>&#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现的效果如下图，需要注意的一点就是采用这种方式需要给页面加最小宽度</p>
<img src="/2356874721.github.io/2020/07/15/css-holygrail-twinwing/11.png" class>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>零零总总的写了两天了，办法总比困难多，以上算是自己学习的一个过程吧。里面有些内容可能还是介绍的比较浅显，也可能是自己理解的还不够深入，下一篇深入的学习下margin负边距这个东西吧。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/14/js-event-loop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/14/js-event-loop/" class="post-title-link" itemprop="url">js事件执行机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-14 15:31:50" itemprop="dateCreated datePublished" datetime="2020-07-14T15:31:50+08:00">2020-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我们知道js的两大特点，一是单线程，二是js解释性语言，即解释一行执行一行。而单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。那么为什么js要设计成单线程呢？多线程不是更快并且体验上更好吗？</p>
<h2 id="js是单线程的原因"><a href="#js是单线程的原因" class="headerlink" title="js是单线程的原因"></a>js是单线程的原因</h2><p>JavaScript的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。</p>
<h2 id="主线程"><a href="#主线程" class="headerlink" title="主线程"></a>主线程</h2><p>也就是 js 引擎执行的线程，这个线程只有一个，一般执行代码块的时候，也就是程序执行进入主线程。</p>
<h2 id="任务队列"><a href="#任务队列" class="headerlink" title="任务队列"></a>任务队列</h2><p>前面说了单线程的特点就是要排队，如果前一个任务耗时很长，后一个任务就不得不一直等着。</p>
<p>于是，所有任务可以分成两种，一种是同步任务（synchronous），另一种是异步任务（asynchronous）。同步任务指的是，在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；异步任务指的是，不进入主线程、而进入”任务队列”（task queue） 的任务，只有”任务队列”通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。也就是说，所有任务最后的执行都是在主线程上被执行的。</p>
<p>那么js的执行机制到底是怎样的呢？</p>
<h2 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h2><p>•整体的代码块(<strong>作为第一个宏任务</strong>)开始执行的时候，会把所有代码分为两部分：“同步任务”、“异步任务”；</p>
<p>•同步任务会直接进入主线程依次执行；</p>
<p>•异步任务会再分为宏任务和微任务；</p>
<p>•宏任务进入到Event Table中，并在里面注册回调函数，每当指定的事件完成时，Event Table会将这个函数移到Event Queue中；</p>
<p>•微任务也会进入到另一个Event Table中，并在里面注册回调函数，每当指定的事件完成时，Event Table会将这个函数移到Event Queue中；</p>
<p>•当主线程内的任务执行完毕，<strong>主线程为空时，会检查微任务的Event Queue</strong>，如果有任务，就全部执行，如果没有就执行<strong>下一个宏任务</strong>，<strong>进入下一次循环</strong></p>
<p>•循环开始还是检查有没有同步任务，有则直接执行</p>
<p>•同步任务执行完，执行所有微任务，执行完后再把下一个宏任务拿到主线程上执行</p>
<p>…</p>
<p>•上述过程会不断重复，这就是Event Loop事件循环</p>
<p>注意的点：</p>
<p>•所有任务最后都是在主线程上被执行的</p>
<p>•微任务执行完就标志着一次循环完成了</p>
<p>•执行的时候先把一个宏任务拿到主线程上执行，执行该宏任务下的同步任务和微任务</p>
<p>下面可以看几个例子加深印象</p>
<h3 id="练习题1"><a href="#练习题1" class="headerlink" title="练习题1"></a>练习题1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">分析过程：</span><br><span class="line">•首先整个代码块是一个宏任务，进到主线程开始执行</span><br><span class="line">•<span class="built_in">console</span>.log(<span class="number">1</span>)是同步任务，直接输出 <span class="number">1</span></span><br><span class="line">•执行setTimeout，setTimeout是异步任务，并且是一个宏任务，因此把setTimeout回调函数放到宏任务队列中，记为timer1</span><br><span class="line">•执行<span class="built_in">Promise</span>，有两个then方法，是异步任务，并且是微任务，放到微任务队列中，记为then1,then2</span><br><span class="line">•<span class="built_in">console</span>.log(<span class="number">5</span>);同步任务，直接输出 <span class="number">5</span></span><br><span class="line">•同步任务执行完毕，开始执行微任务，此时微任务队列中如下：</span><br><span class="line"> [then1,then1]</span><br><span class="line"> 宏任务队列：</span><br><span class="line"> [timer]</span><br><span class="line">•执行then1，<span class="built_in">console</span>.log(<span class="number">3</span>) 输出 <span class="number">3</span></span><br><span class="line">•执行then2,<span class="built_in">console</span>.log(<span class="number">4</span>) 输出 <span class="number">4</span></span><br><span class="line">•至此所有微任务执行完，进入下一次循环</span><br><span class="line">•拿出事件队列中第一个宏任务timer，开始执行</span><br><span class="line">•执行该任务下的同步任务，<span class="built_in">console</span>.log(<span class="number">2</span>) 输出 <span class="number">2</span></span><br><span class="line">•检查该任务下的微任务，没有微任务，进入下一个宏任务</span><br><span class="line">•没有宏任务了，执行中止了</span><br></pre></td></tr></table></figure>

<h3 id="练习题2"><a href="#练习题2" class="headerlink" title="练习题2"></a>练习题2</h3><p>本练习题想说明的是setTimeout时间的问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer1</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line">add();</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer2</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer3</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>)</span><br><span class="line">  &#125;, <span class="number">100</span>)</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    i == <span class="number">99</span> &amp;&amp; resolve()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer4</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">6</span>) </span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">7</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">分析过程：</span><br><span class="line">•整个代码块是一个宏任务，拿到主线程上执行</span><br><span class="line">•add()执行add函数，<span class="built_in">console</span>.log(<span class="number">1</span>)是同步任务，直接输出 ==&gt; <span class="number">1</span></span><br><span class="line">•setTimeout是宏任务，放到宏任务队列，记为timer1,注意<span class="number">1000</span>这个时间</span><br><span class="line">•接下来setTimeout，放到宏任务队列，记为timer2 ，时间是<span class="number">0</span></span><br><span class="line">•<span class="keyword">new</span> <span class="built_in">Promise</span>，<span class="built_in">console</span>.log(<span class="number">4</span>)是同步任务，输出 ==&gt; <span class="number">4</span></span><br><span class="line">•setTimeout是宏任务，记为timer3，时间是<span class="number">100</span></span><br><span class="line">•then是微任务，放到微任务队列，记为then1</span><br><span class="line">•<span class="built_in">console</span>.log(<span class="number">8</span>)直接输出 ==&gt; <span class="number">8</span></span><br><span class="line">•同步任务执行完毕，此时微任务有[then1]，宏任务有[timer1,timer2,timer3]</span><br><span class="line">•执行微任务then1，有setTimeout，放到宏任务队列，记为timer4，<span class="built_in">console</span>.log(<span class="number">7</span>)输出==&gt; <span class="number">7</span></span><br><span class="line">•微任务执行完毕，执行第一个宏任务，此时宏任务队列是[timer1,timer2,timer3,timer4]，但是这里要特别注意时间，时间会决定setTimeout的执行顺序，因此最终的执行顺序是[timer2,timer4,timer3,timer1]</span><br><span class="line">•因此拿出宏任务队列的第一个任务timer2执行，输出 ==&gt; <span class="number">3</span></span><br><span class="line">•该宏任务下没有微任务，进入下一次循环</span><br><span class="line">•拿出宏任务队列的第二个任务timer4执行，输出 ==&gt; <span class="number">6</span></span><br><span class="line">•该宏任务下没有微任务，进入下一次循环</span><br><span class="line">•拿出宏任务队列的第二个任务timer3执行，输出 ==&gt; <span class="number">5</span></span><br><span class="line">•该宏任务下没有微任务，进入下一次循环</span><br><span class="line">•拿出宏任务队列的第二个任务timer1执行，输出 ==&gt; <span class="number">2</span></span><br><span class="line">•该宏任务下没有微任务，进入下一次循环</span><br><span class="line">•宏任务队列也没有待执行的任务了，执行中止了</span><br></pre></td></tr></table></figure>

<h3 id="练习题3"><a href="#练习题3" class="headerlink" title="练习题3"></a>练习题3</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer1</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// timer3</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  <span class="comment">// timer2</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">•代码块执行，先执行同步任务，结束之后得到宏任务队列[timer1,timer2]，没有微任务，进入下一次循环</span><br><span class="line">•拿出timer1执行，输出 ==&gt; <span class="number">1</span></span><br><span class="line">•setTimeout记为timer3，timer1中没有微任务了，进入下一次循环，此时宏任务队列[timer2,timer3]</span><br><span class="line">•拿出timer2执行，输出 ==&gt; <span class="number">3</span>，timer2中没有微任务了，进入下一次循环</span><br><span class="line">•拿出timer3执行，输出 ==&gt; <span class="number">2</span>，没有微任务了，进入下一次循环</span><br><span class="line">•宏任务队列也空了，执行中止</span><br></pre></td></tr></table></figure>

<h3 id="练习题4"><a href="#练习题4" class="headerlink" title="练习题4"></a>练习题4</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'1'</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer1</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2'</span>);</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// nextTick2</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'3'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'4'</span>);</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// then1</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'5'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// nextTick1</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'6'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'7'</span>);</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// Promise1</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'8'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// timer2</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'9'</span>);</span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// nextTick3</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'10'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'11'</span>);</span><br><span class="line">        resolve();</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// then2</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'12'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">•主线程执行，<span class="built_in">console</span>.log(<span class="string">'1'</span>) ==&gt; <span class="number">1</span></span><br><span class="line">  setTimeout ==&gt; 宏任务队列[timer1]</span><br><span class="line">  process.nextTick ==&gt; 微任务队列[nextTick1]</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span> 输出 ==&gt; <span class="number">7</span> </span><br><span class="line">                  ==&gt; 微任务队列[nextTick1,Promise1]</span><br><span class="line">  setTimeout ==&gt; 宏任务队列[timer1,timer2]</span><br><span class="line">•执行微任务nextTick1 ==&gt; <span class="number">6</span></span><br><span class="line">•执行微任务Promise1 ==&gt; <span class="number">8</span></span><br><span class="line">•所有微任务执行完毕，进入下一次循环</span><br><span class="line">•执行宏任务队列中第一个timer1，<span class="built_in">console</span>.log(<span class="string">'2'</span>) ==&gt; <span class="number">2</span></span><br><span class="line">                    process.nextTick ==&gt; 微任务队列[nextTick2]</span><br><span class="line">                    <span class="keyword">new</span> <span class="built_in">Promise</span> ==&gt; <span class="built_in">console</span>.log(<span class="string">'4'</span>)==&gt; <span class="number">4</span></span><br><span class="line">                                    then ==&gt; 微任务队列[nextTick2,then1]</span><br><span class="line">•执行timer1中的微任务 nextTick2 ==&gt; <span class="number">3</span></span><br><span class="line">                    then1 ==&gt; <span class="number">5</span></span><br><span class="line">•timer1微任务执行完毕，进入下一次循环</span><br><span class="line">•执行timer2  <span class="built_in">console</span>.log(<span class="string">'9'</span>) ==&gt; <span class="number">9</span></span><br><span class="line">            process.nextTick ==&gt; 微任务队列[nextTick3]</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">Promise</span> <span class="built_in">console</span>.log(<span class="string">'11'</span>) ==&gt; <span class="number">11</span></span><br><span class="line">                                    then  ==&gt; 微任务队列[nextTick3,then2]</span><br><span class="line">•执行timer2中的微任务 nextTick3 ==&gt; <span class="number">10</span></span><br><span class="line">                        then2 ==&gt; <span class="number">12</span></span><br><span class="line">                        </span><br><span class="line">最终执行结果是：<span class="number">1</span> <span class="number">7</span> <span class="number">6</span> <span class="number">8</span> <span class="number">2</span> <span class="number">4</span> <span class="number">3</span> <span class="number">5</span> <span class="number">9</span> <span class="number">11</span> <span class="number">10</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/14/js_this/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/14/js_this/" class="post-title-link" itemprop="url">this</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-14 15:31:50" itemprop="dateCreated datePublished" datetime="2020-07-14T15:31:50+08:00">2020-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>this只要记住以下4点</p>
<h2 id="函数预编译过程，this指向window"><a href="#函数预编译过程，this指向window" class="headerlink" title="函数预编译过程，this指向window"></a>函数预编译过程，this指向window</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">123</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">c</span> (<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>我们知道这段代码考的是预编译，预编译过程如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">test函数执行，会生成AO</span><br><span class="line">AO:&#123;</span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">  b: <span class="literal">undefined</span></span><br><span class="line">  c: <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">其实在形成的AO中，还应该有这两个东西，一个是<span class="keyword">this</span>，一个是<span class="built_in">arguments</span>,即AO本来面目为：</span><br><span class="line">AO:&#123;</span><br><span class="line">  argumnets:<span class="number">1</span></span><br><span class="line">  <span class="keyword">this</span>: <span class="built_in">window</span></span><br><span class="line">  a: <span class="number">1</span></span><br><span class="line">  b: <span class="literal">undefined</span></span><br><span class="line">  c: <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>要记住，预编译阶段，this指向window</strong>，下面通过一个小例子来测试一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br><span class="line">输出：Window对象</span><br></pre></td></tr></table></figure>

<h2 id="全局作用域，this指向window"><a href="#全局作用域，this指向window" class="headerlink" title="全局作用域，this指向window"></a>全局作用域，this指向window</h2><p>在GO里面，this指向window</p>
<h2 id="call-apply可以改变this指向"><a href="#call-apply可以改变this指向" class="headerlink" title="call/apply可以改变this指向"></a>call/apply可以改变this指向</h2><p>Person.call(obj,1,2,3)，call和apply的第一个参数，就是this指向</p>
<h2 id="obj-fn"><a href="#obj-fn" class="headerlink" title="obj.fn()"></a>obj.fn()</h2><p>obj.fn()，fn函数里面的this就指向obj</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	name: <span class="string">'sheriff'</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.say() <span class="comment">// this指向obj</span></span><br><span class="line">输出：<span class="string">'sheriff'</span></span><br></pre></td></tr></table></figure>

<h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><p>下面通过一些题目来检验一下自己吧</p>
<h3 id="练习题1"><a href="#练习题1" class="headerlink" title="练习题1"></a>练习题1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'222'</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  name: <span class="string">'111'</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fun = a.say</span><br><span class="line">fun()</span><br><span class="line">a.say() </span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">  name: <span class="string">'333'</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span>(<span class="params">fun</span>)</span>&#123;</span><br><span class="line">    fun()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">b.say(a.say) </span><br><span class="line">b.say = a.say</span><br><span class="line">b.say()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">分析过程：</span><br><span class="line">•var fun &#x3D; a.say，等价于 </span><br><span class="line"> var fun &#x3D; function()&#123;</span><br><span class="line">    console.log(this.name)</span><br><span class="line"> &#125;</span><br><span class="line"> this指向window，所以fun()输出 222</span><br><span class="line"></span><br><span class="line">•a.say()是直接执行对象上的方法，是第四条，this指向a,因此输出 111</span><br><span class="line">•b.say(a.say)首先b.say(),say函数内部的this指向b,但传递进去一个函数作为参数</span><br><span class="line">var b &#x3D; &#123;</span><br><span class="line">  name: &#39;333&#39;,</span><br><span class="line">  say: function(fun)&#123;</span><br><span class="line">    &#x2F;&#x2F; this &#x3D;&#x3D;&gt; b</span><br><span class="line">    fun()</span><br><span class="line">    &#x2F;&#x2F; fun() &#x3D;&#x3D;&gt;等价于下面的写法</span><br><span class="line">    function()&#123;</span><br><span class="line">      console.log(this.name)</span><br><span class="line">      &#x2F;&#x2F;这里面的this是预编译的this，指向window,因此输出 222</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">•b.say &#x3D; a.say等价于，this指向b,输出 333</span><br><span class="line">var b &#x3D; &#123;</span><br><span class="line">  name: &#39;333&#39;,</span><br><span class="line">  say: function()&#123;</span><br><span class="line">    console.log(this.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">•最终结果：222 111 222 333</span><br></pre></td></tr></table></figure>

<h3 id="练习题2"><a href="#练习题2" class="headerlink" title="练习题2"></a>练习题2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">111</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.a = <span class="number">222</span></span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">分析过程：</span><br><span class="line">•GO:&#123;<span class="attr">a</span>:<span class="number">111</span>&#125;</span><br><span class="line">•AO:&#123;&#125;</span><br><span class="line">test中的<span class="keyword">this</span>指向<span class="built_in">window</span>，<span class="keyword">this</span>.a就是<span class="built_in">window</span>.a = <span class="number">222</span></span><br><span class="line">此时GO:&#123;<span class="attr">a</span>:<span class="number">222</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a)，AO中没有a，因此到GO上找，即 <span class="number">222</span></span><br><span class="line">输出： <span class="number">222</span></span><br></pre></td></tr></table></figure>

<h3 id="练习题3"><a href="#练习题3" class="headerlink" title="练习题3"></a>练习题3</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">111</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.a = <span class="number">222</span></span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> test()</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">分析过程：</span><br><span class="line"><span class="keyword">new</span> test()实际上发生的是如下过程：</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">  <span class="comment">// this.obj = &#123;&#125;</span></span><br><span class="line">  <span class="comment">// obj._ proto_ = Person.prototype</span></span><br><span class="line">  <span class="keyword">this</span>.a = <span class="number">222</span> </span><br><span class="line"> <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line">所以这里<span class="keyword">this</span>指向实例化出来的对象，而输出的是AO里面的a，没有就去GO找</span><br><span class="line">输出结果：<span class="number">111</span></span><br></pre></td></tr></table></figure>

<h3 id="练习题3-1"><a href="#练习题3-1" class="headerlink" title="练习题3"></a>练习题3</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  a = <span class="number">0</span></span><br><span class="line">  alert(a)</span><br><span class="line">  alert(<span class="keyword">this</span>.a)</span><br><span class="line">  <span class="keyword">var</span> a</span><br><span class="line">  alert(a)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br><span class="line"><span class="keyword">new</span> test()</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">分析过程：</span><br><span class="line">•GO:&#123;<span class="attr">a</span>: <span class="number">5</span>&#125;</span><br><span class="line">•test()执行，生成AO</span><br><span class="line">AO:&#123;</span><br><span class="line">  a: <span class="number">0</span></span><br><span class="line">  <span class="keyword">this</span>: <span class="built_in">window</span></span><br><span class="line">&#125;</span><br><span class="line">因此输出结果：<span class="number">0</span> <span class="number">5</span> <span class="number">0</span></span><br><span class="line">•<span class="keyword">new</span> test()执行</span><br><span class="line">AO:&#123;</span><br><span class="line">  a: <span class="number">0</span></span><br><span class="line">  <span class="keyword">this</span>:&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：<span class="number">0</span> <span class="literal">undefined</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/13/webpack-tapable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/13/webpack-tapable/" class="post-title-link" itemprop="url">Tapable钩子</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-13 18:07:31" itemprop="dateCreated datePublished" datetime="2020-07-13T18:07:31+08:00">2020-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>webpack本质上是一种事件流的机制，它的工作流程就是将各个插件串联起来，而实现这一切的核心就是Tapable。</p>
<p>Tapable提供了同步和异步的钩子函数，下面就来一起学习使用这个钩子函数，并且搞清楚这些钩子的实现原理。</p>
<h2 id="Tapable钩子分类"><a href="#Tapable钩子分类" class="headerlink" title="Tapable钩子分类"></a>Tapable钩子分类</h2><p>Tapable的同步钩子有：SyncHook、SyncBailHook、SyncLoopHook、syncWaterFallHook</p>
<p>Tapable的异步钩子有：AsyncSeriesHook、AsyncParallelHook、AsyncSeriesWaterfallHook</p>
<h2 id="SyncHook"><a href="#SyncHook" class="headerlink" title="SyncHook"></a>SyncHook</h2><h3 id="SyncHook使用"><a href="#SyncHook使用" class="headerlink" title="SyncHook使用"></a>SyncHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* syncHook 勾子功能非常简单，就是一个发布/订阅模式。注册在实例上函数被依次的执行。 */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; SyncHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> syncHook = <span class="keyword">new</span> SyncHook([<span class="string">'name'</span>]) <span class="comment">// 这里的参数注意一下</span></span><br><span class="line"></span><br><span class="line">syncHook.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">syncHook.tap(<span class="string">'2'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`go out <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">syncHook.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="SyncHook原理"><a href="#SyncHook原理" class="headerlink" title="SyncHook原理"></a>SyncHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 核心原理就是一个发布订阅模式 */</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.task = [] <span class="comment">// 存放回调的数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn(...args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> sync = <span class="keyword">new</span> SyncHook()</span><br><span class="line">sync.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">sync.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`go out <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">sync.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="SyncBailHook"><a href="#SyncBailHook" class="headerlink" title="SyncBailHook"></a>SyncBailHook</h2><h3 id="SyncBailHook使用"><a href="#SyncBailHook使用" class="headerlink" title="SyncBailHook使用"></a>SyncBailHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* bail 保险的意思，当函数返回非undefined时，停止向下执行 */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; SyncBailHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> syncBailHook = <span class="keyword">new</span> SyncBailHook([<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">syncBailHook.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'停止'</span></span><br><span class="line">&#125;)</span><br><span class="line">syncBailHook.tap(<span class="string">'2'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`go out <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">syncBailHook.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="SyncBailHook原理"><a href="#SyncBailHook原理" class="headerlink" title="SyncBailHook原理"></a>SyncBailHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncBailHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.task = [] <span class="comment">// 存放回调的数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="comment">/* 判断函数是否返回了非undefined，如果是，那么停止向下执行 */</span> </span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span> <span class="comment">// 当前执行函数的索引</span></span><br><span class="line">    <span class="keyword">let</span> ret <span class="comment">// 当前函数的返回值</span></span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">      ret = <span class="keyword">this</span>.task[index](...args)</span><br><span class="line">    &#125;<span class="keyword">while</span>(ret === <span class="literal">undefined</span> &amp;&amp; index &lt; <span class="keyword">this</span>.task.length)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> sync = <span class="keyword">new</span> SyncBailHook()</span><br><span class="line">sync.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'停止吧'</span></span><br><span class="line">&#125;)</span><br><span class="line">sync.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`go out <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line">sync.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="SyncLoopHook"><a href="#SyncLoopHook" class="headerlink" title="SyncLoopHook"></a>SyncLoopHook</h2><h3 id="SyncLoopHook使用"><a href="#SyncLoopHook使用" class="headerlink" title="SyncLoopHook使用"></a>SyncLoopHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 返回非undefined的时候，函数一直执行，返回undefined时，才往下执行 */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; SyncLoopHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> syncLoopHook = <span class="keyword">new</span> SyncLoopHook([<span class="string">'name'</span>])</span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">syncLoopHook.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  index ++</span><br><span class="line">  <span class="keyword">return</span> index &gt;= <span class="number">3</span> ? <span class="literal">undefined</span> : <span class="string">"不能停"</span></span><br><span class="line">&#125;)</span><br><span class="line">syncLoopHook.tap(<span class="string">'2'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data + <span class="string">'第一次'</span>) <span class="comment">// ==&gt; lwj第一次</span></span><br><span class="line">&#125;)</span><br><span class="line">syncLoopHook.tap(<span class="string">'3'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data + <span class="string">'第二次'</span>) <span class="comment">// ==&gt; lwj第二次</span></span><br><span class="line">&#125;)</span><br><span class="line">syncLoopHook.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="SyncLoopHook原理"><a href="#SyncLoopHook原理" class="headerlink" title="SyncLoopHook原理"></a>SyncLoopHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncWaterfallHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.task = [] <span class="comment">// 存放回调的数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="comment">/* 所有函数都要执行，函数返回非undefined的要反复执行 */</span></span><br><span class="line">    <span class="keyword">this</span>.task.forEach(<span class="function"><span class="params">task</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> ret</span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        ret = task(...args)</span><br><span class="line">      &#125;<span class="keyword">while</span>(ret !== <span class="literal">undefined</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> sync = <span class="keyword">new</span> SyncWaterfallHook()</span><br><span class="line">sync.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  index ++</span><br><span class="line">  <span class="keyword">return</span> index &gt;= <span class="number">3</span> ? <span class="literal">undefined</span> : <span class="string">'不能停'</span></span><br><span class="line">&#125;)</span><br><span class="line">sync.tap(<span class="string">'2'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data+<span class="string">'第一次'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">sync.tap(<span class="string">'3'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data+<span class="string">'第二次'</span>) </span><br><span class="line">&#125;)</span><br><span class="line">sync.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="syncWaterFallHook"><a href="#syncWaterFallHook" class="headerlink" title="syncWaterFallHook"></a>syncWaterFallHook</h2><h3 id="syncWaterFallHook使用"><a href="#syncWaterFallHook使用" class="headerlink" title="syncWaterFallHook使用"></a>syncWaterFallHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* waterfall 瀑布，上一个函数的返回结果，会传到作为下一个函数参数传入 */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; SyncWaterfallHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> syncWaterfallHook = <span class="keyword">new</span> SyncWaterfallHook([<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">syncWaterfallHook.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'可以停止吗'</span></span><br><span class="line">&#125;)</span><br><span class="line">syncWaterfallHook.tap(<span class="string">'2'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data) <span class="comment">// ==&gt; 可以停止吗</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'停止吧'</span></span><br><span class="line">&#125;)</span><br><span class="line">syncWaterfallHook.tap(<span class="string">'3'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data) <span class="comment">// ==&gt; 停止吧</span></span><br><span class="line">&#125;)</span><br><span class="line">syncWaterfallHook.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="syncWaterFallHook原理"><a href="#syncWaterFallHook原理" class="headerlink" title="syncWaterFallHook原理"></a>syncWaterFallHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncWaterfallHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.task = [] <span class="comment">// 存放回调的数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  tap(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  call(...args)&#123;</span><br><span class="line">    <span class="comment">/* 把上一个函数的返回值，作为下一个函数的参数传入，很容易想到reduce */</span> </span><br><span class="line">    <span class="keyword">let</span> [first,...others] = <span class="keyword">this</span>.task</span><br><span class="line">    <span class="keyword">let</span> ret = first(...args)</span><br><span class="line">    others.reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> b(a)</span><br><span class="line">    &#125;,ret)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> sync = <span class="keyword">new</span> SyncWaterfallHook()</span><br><span class="line">sync.tap(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`come here <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'停止吗'</span></span><br><span class="line">&#125;)</span><br><span class="line">sync.tap(<span class="string">'2'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data) <span class="comment">// ==&gt; 停止吗</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'停止吧'</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">sync.tap(<span class="string">'3'</span>,(data)=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data) <span class="comment">// ==&gt; 停止吧</span></span><br><span class="line">&#125;)</span><br><span class="line">sync.call(<span class="string">'lwj'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="AsyncSeriesHook"><a href="#AsyncSeriesHook" class="headerlink" title="AsyncSeriesHook"></a>AsyncSeriesHook</h2><h3 id="AsyncSeriesHook使用"><a href="#AsyncSeriesHook使用" class="headerlink" title="AsyncSeriesHook使用"></a>AsyncSeriesHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* 上一个函数执行完成，下一个函数才执行，所有函数执行完，最终函数才会执行 */</span> </span><br><span class="line"><span class="comment">// let &#123; AsyncSeriesHook &#125; = require('tapable')</span></span><br><span class="line"><span class="comment">// const asyncSeriesHook = new AsyncSeriesHook(['name'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// asyncSeriesHook.tapAsync('1',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(`come here $&#123;name&#125;`)</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.tapAsync('2',(data,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(data + '第一次')</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.tapAsync('3',(data,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(data + '第二次') </span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.callAsync('lwj',() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log('end')</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tapPromise promise */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; AsyncSeriesHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> asyncSeriesHook = <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">asyncSeriesHook.tapPromise(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第一次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesHook.tapPromise(<span class="string">'2'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第二次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesHook.tapPromise(<span class="string">'3'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第三次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesHook.promise(<span class="string">'lwj'</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="AsyncSeriesHook原理"><a href="#AsyncSeriesHook原理" class="headerlink" title="AsyncSeriesHook原理"></a>AsyncSeriesHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class AsyncSeriesHook&#123;</span></span><br><span class="line"><span class="comment">//   constructor()&#123;</span></span><br><span class="line"><span class="comment">//     this.task = [] // 存放回调的数组</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   tapAsync(name,task)&#123;</span></span><br><span class="line"><span class="comment">//     this.task.push(task)</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   callAsync(...args)&#123;</span></span><br><span class="line"><span class="comment">//     let finalFn = args.pop() // 拿到最终执行的函数</span></span><br><span class="line"><span class="comment">//     let index = 0</span></span><br><span class="line"><span class="comment">//     let next = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       if(index === this.task.length) return finalFn()  // 计数，每执行一个事件处理函数就+1，当计数器等于事件处理函数数组的长度时，就说明事件处理函数全部都执行完毕了，该执行最终的回调函数了</span></span><br><span class="line"><span class="comment">//       let task = this.task[index ++] // 取每一个处理函数的回调，拿出来执行</span></span><br><span class="line"><span class="comment">//       task(...args,next) // 处理函数有两个参数，一个是args,一个是cb，cb也就是下一个事件处理函数</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     next()</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// let asyncSeriesHook = new AsyncSeriesHook()</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.tapAsync('1',(name,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(`come here $&#123;name&#125;`)</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.tapAsync('2',(name,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(name + '第一次')</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.tapAsync('3',(name,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(name + '第二次') </span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesHook.callAsync('lwj',() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log('end')</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tapPromise */</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.task = [] <span class="comment">// 存放回调的数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  tapPromise(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  promise(...args)&#123;</span><br><span class="line">    <span class="keyword">let</span> [first,...others] = <span class="keyword">this</span>.task</span><br><span class="line">    <span class="keyword">return</span> others.reduce(<span class="function">(<span class="params">p,next</span>) =&gt;</span> &#123; <span class="comment">// p是事件处理函数的返回值，是一个promise,下一个方法放到promise的then方法中去执行</span></span><br><span class="line">      <span class="keyword">return</span> p.then(<span class="function"><span class="params">()</span> =&gt;</span> next(...args))</span><br><span class="line">    &#125;,first(...args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> asyncSeriesHook = <span class="keyword">new</span> AsyncSeriesHook()</span><br><span class="line">asyncSeriesHook.tapPromise(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第一次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesHook.tapPromise(<span class="string">'2'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第二次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesHook.tapPromise(<span class="string">'3'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第三次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesHook.promise(<span class="string">'lwj'</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="AsyncParallelHook"><a href="#AsyncParallelHook" class="headerlink" title="AsyncParallelHook"></a>AsyncParallelHook</h2><h3 id="AsyncParallelHook使用"><a href="#AsyncParallelHook使用" class="headerlink" title="AsyncParallelHook使用"></a>AsyncParallelHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 每一个函数的回调cb都执行完，最终的回调函数才会执行，如果有一个函数的回调没有执行，那么最终的回调就不会执行 */</span> </span><br><span class="line"><span class="comment">// let &#123; AsyncParallelHook &#125; = require('tapable')</span></span><br><span class="line"><span class="comment">// const asyncParallelHook = new AsyncParallelHook(['name'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// asyncParallelHook.tapAsync('1',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(`come here $&#123;name&#125;`)</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncParallelHook.tapAsync('2',(data,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(data + '第一次')</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncParallelHook.tapAsync('3',(data,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(data + '第二次') </span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncParallelHook.callAsync('lwj',() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log('end')</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tapPromise promise */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; AsyncParallelHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> asyncParallelHook = <span class="keyword">new</span> AsyncParallelHook([<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">asyncParallelHook.tapPromise(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第一次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncParallelHook.tapPromise(<span class="string">'2'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第二次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncParallelHook.tapPromise(<span class="string">'3'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第三次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncParallelHook.promise(<span class="string">'lwj'</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="AsyncParallelHook原理"><a href="#AsyncParallelHook原理" class="headerlink" title="AsyncParallelHook原理"></a>AsyncParallelHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class AsyncParallelHook&#123;</span></span><br><span class="line"><span class="comment">//   constructor()&#123;</span></span><br><span class="line"><span class="comment">//     this.task = [] // 存放回调的数组</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   tapAsync(name,task)&#123;</span></span><br><span class="line"><span class="comment">//     this.task.push(task)</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   callAsync(...args)&#123;</span></span><br><span class="line"><span class="comment">//     let finalFn = args.pop() // 最终要执行的回调</span></span><br><span class="line"><span class="comment">//     let index = 0</span></span><br><span class="line"><span class="comment">//     let done = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       index ++</span></span><br><span class="line"><span class="comment">//       if(index == this.task.length)&#123; // 计数，当index为回调函数的长度时，执行最终要执行的回调finalFn</span></span><br><span class="line"><span class="comment">//         finalFn()</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     this.task.forEach(task =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       task(...args,done)</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// let asyncParallelHook = new AsyncParallelHook()</span></span><br><span class="line"><span class="comment">// asyncParallelHook.tapAsync('1',(name,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(`come here $&#123;name&#125;`)</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncParallelHook.tapAsync('2',(data,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(data + '第一次')</span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncParallelHook.tapAsync('3',(data,cb) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(data + '第二次') </span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncParallelHook.callAsync('lwj',() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log('end')</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tapPromise */</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncParallelHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>.task = [] <span class="comment">// 存放回调的数组</span></span><br><span class="line">  &#125;</span><br><span class="line">  tapPromise(name,task)&#123;</span><br><span class="line">    <span class="keyword">this</span>.task.push(task)</span><br><span class="line">  &#125;</span><br><span class="line">  promise(...args)&#123;</span><br><span class="line">    <span class="keyword">let</span> tasks = <span class="keyword">this</span>.task.map(<span class="function"><span class="params">task</span> =&gt;</span> task(...args)) <span class="comment">// map循环，返回的是promise数组</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(tasks)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> asyncParallelHook = <span class="keyword">new</span> AsyncParallelHook()</span><br><span class="line">asyncParallelHook.tapPromise(<span class="string">'1'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第一次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncParallelHook.tapPromise(<span class="string">'2'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第二次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncParallelHook.tapPromise(<span class="string">'3'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span> 第三次`</span>)</span><br><span class="line">    resolve()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncParallelHook.promise(<span class="string">'lwj'</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="AsyncSeriesWaterfallHook"><a href="#AsyncSeriesWaterfallHook" class="headerlink" title="AsyncSeriesWaterfallHook"></a>AsyncSeriesWaterfallHook</h2><h3 id="AsyncSeriesWaterfallHook使用"><a href="#AsyncSeriesWaterfallHook使用" class="headerlink" title="AsyncSeriesWaterfallHook使用"></a>AsyncSeriesWaterfallHook使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* waterfall 瀑布，上一个函数的返回结果，会传到作为下一个函数参数传入，如果报错了，跳过下一个函数*/</span> </span><br><span class="line"><span class="comment">// let &#123; AsyncSeriesWaterfallHook &#125; = require('tapable')</span></span><br><span class="line"><span class="comment">// const asyncSeriesWaterfallHook = new AsyncSeriesWaterfallHook(['name'])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.tapAsync('1',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(`come here $&#123;name&#125;`)</span></span><br><span class="line"><span class="comment">//   cb(null,1)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.tapAsync('2',(data,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(data) </span></span><br><span class="line"><span class="comment">//   cb('error',2) // 第一个参数有值的话代表出错，执行的时候会跳过下一个函数</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.tapAsync('3',(data,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   console.log(data) </span></span><br><span class="line"><span class="comment">//   cb()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.callAsync('lwj',() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log('end')</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tapPromise */</span> </span><br><span class="line"><span class="keyword">let</span> &#123; AsyncSeriesWaterfallHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>)</span><br><span class="line"><span class="keyword">const</span> asyncSeriesWaterfallHook = <span class="keyword">new</span> AsyncSeriesWaterfallHook([<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">asyncSeriesWaterfallHook.tapPromise(<span class="string">'1'</span>,(name) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name)</span><br><span class="line">    resolve(<span class="string">'在下一步展示'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesWaterfallHook.tapPromise(<span class="string">'2'</span>,(data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">    resolve(<span class="string">'在下一步展示'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesWaterfallHook.tapPromise(<span class="string">'3'</span>,(data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">    resolve(<span class="string">'在下一步展示'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">asyncSeriesWaterfallHook.promise(<span class="string">'lwj'</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="AsyncSeriesWaterfallHook原理"><a href="#AsyncSeriesWaterfallHook原理" class="headerlink" title="AsyncSeriesWaterfallHook原理"></a>AsyncSeriesWaterfallHook原理</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class AsyncSeriesWaterfallHook&#123;</span></span><br><span class="line"><span class="comment">//   constructor(args)&#123; /* args -&gt; ['name']) */</span></span><br><span class="line"><span class="comment">//     this.tasks = [];</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   /** tap接收两个参数 name和fn */</span></span><br><span class="line"><span class="comment">//   tapAsync(name,fn)&#123;</span></span><br><span class="line"><span class="comment">//     /** 订阅:将fn放入到this.tasks中 */</span></span><br><span class="line"><span class="comment">//     this.tasks.push(fn);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   callAsync(...args)&#123;</span></span><br><span class="line"><span class="comment">//     let index = 0;</span></span><br><span class="line"><span class="comment">//     /** 1 拿到最后的最终的回调 */</span></span><br><span class="line"><span class="comment">//     let finalCallBack = args.pop();</span></span><br><span class="line"><span class="comment">//     let next = (err,data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//         /** 拿到每个task */</span></span><br><span class="line"><span class="comment">//         let task = this.tasks[index];</span></span><br><span class="line"><span class="comment">//         /** 2 如果没传task 或者全部task都执行完毕</span></span><br><span class="line"><span class="comment">//          * return 直接执行最终的回调finalCallBack()</span></span><br><span class="line"><span class="comment">//          */</span></span><br><span class="line"><span class="comment">//         if(!task) return finalCallBack();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         if(index === 0)&#123;</span></span><br><span class="line"><span class="comment">//             /** 3 执行第一个task</span></span><br><span class="line"><span class="comment">//              * 并传递参数为原始参数args</span></span><br><span class="line"><span class="comment">//              */</span></span><br><span class="line"><span class="comment">//             task(...args, next);</span></span><br><span class="line"><span class="comment">//         &#125;else&#123;</span></span><br><span class="line"><span class="comment">//             /** 4 执行处第二个外的每个task</span></span><br><span class="line"><span class="comment">//              * 并传递的参数 data</span></span><br><span class="line"><span class="comment">//              *  data -&gt;‘传递给下一步的结果’</span></span><br><span class="line"><span class="comment">//              */</span></span><br><span class="line"><span class="comment">//             task(data, next);</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         index++;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     /** 执行next() */</span></span><br><span class="line"><span class="comment">//     next();</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// let asyncSeriesWaterfallHook = new AsyncSeriesWaterfallHook(['name']);</span></span><br><span class="line"><span class="comment">// /** 订阅 */</span></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.tapAsync('react',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     console.log('react',name);</span></span><br><span class="line"><span class="comment">//     cb(null,'传递给下一步的结果');</span></span><br><span class="line"><span class="comment">//   &#125;,1000);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.tapAsync('node',(name,cb)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//   setTimeout(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     console.log('node',name);</span></span><br><span class="line"><span class="comment">//     cb();</span></span><br><span class="line"><span class="comment">//   &#125;,1000);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// /** 发布 */</span></span><br><span class="line"><span class="comment">// asyncSeriesWaterfallHook.callAsync('end.',function()&#123;</span></span><br><span class="line"><span class="comment">//   console.log('最终的回调函数');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 打印顺序：</span></span><br><span class="line"><span class="comment">  react end.</span></span><br><span class="line"><span class="comment">  node 传递给下一步的结果</span></span><br><span class="line"><span class="comment">  最终的回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tapPromise */</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesHook</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(args)&#123; </span><br><span class="line">      <span class="keyword">this</span>.tasks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tapPromise(name,fn)&#123;</span><br><span class="line">      <span class="keyword">this</span>.tasks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line">  promise(...args)&#123;</span><br><span class="line">      <span class="comment">/** 1 解构 拿到第一个first</span></span><br><span class="line"><span class="comment">       * first是一个promise</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">let</span> [first, ...others] = <span class="keyword">this</span>.tasks;</span><br><span class="line">      <span class="comment">/** 2 利用reduce方法 累计执行</span></span><br><span class="line"><span class="comment">       * 它最终返回的是一个Promsie</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">return</span> others.reduce(<span class="function">(<span class="params">l,n</span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> l.then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">              <span class="comment">/** 3 将data传给下一个task 即可 */</span></span><br><span class="line">              <span class="keyword">return</span> n(data);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,first(...args));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> h = <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 订阅 */</span></span><br><span class="line">h.tapPromise(<span class="string">'react'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'react'</span>,name);</span><br><span class="line">          resolve(<span class="string">'promise-传递给下一步的结果'</span>);</span><br><span class="line">      &#125;,<span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">h.tapPromise(<span class="string">'node'</span>,(name)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'node'</span>,name);</span><br><span class="line">          resolve();</span><br><span class="line">      &#125;,<span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/** 发布 */</span></span><br><span class="line">h.promise(<span class="string">'end.'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'最终的回调函数'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 打印顺序：</span></span><br><span class="line"><span class="comment">  react end.</span></span><br><span class="line"><span class="comment">  node promise-传递给下一步的结果</span></span><br><span class="line"><span class="comment">  最终的回调函数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/12/js-extend/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/12/js-extend/" class="post-title-link" itemprop="url">原型、原型链、继承</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-12 12:06:01" itemprop="dateCreated datePublished" datetime="2020-07-12T12:06:01+08:00">2020-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><p>原型是<strong><em>function</em></strong>对象的一个属性，它定义了<strong><em>构造函数制造出的对象的公共祖先</em></strong>。通过该构造函数产生的对象，可以继承原型上的属性和方法。<strong><em>原型也是一个对象</em></strong>。</p>
<h2 id="原型的应用"><a href="#原型的应用" class="headerlink" title="原型的应用"></a>原型的应用</h2><p>原型最重要的应用就是提取公有属性。这样写的好处是，方法挂在原型上，好处是每次实例化对象的时候，不用重复的创建函数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Person(name)&#123;</span><br><span class="line">  this.name = name</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.say = <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">  console.log(this.name)</span><br><span class="line">&#125;</span><br><span class="line">person = new Person(<span class="string">'sheriff'</span>)</span><br><span class="line">console.log(person.say)</span><br></pre></td></tr></table></figure>
<p>还有另一种写法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype = &#123;</span><br><span class="line">  say: <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    console.log(this.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="原型上属性的增删改查"><a href="#原型上属性的增删改查" class="headerlink" title="原型上属性的增删改查"></a>原型上属性的增删改查</h2><h3 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person.footer = <span class="string">'footer'</span></span><br><span class="line">通过实例化对象不能给原型增加属性，只能给自己添加属性，给原型添加属性的话，要通过</span><br><span class="line">Person.prototype.footer = <span class="string">'footer'</span></span><br></pre></td></tr></table></figure>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过实例删除属性，自己有这个属性的话，就删除自己的，并不能删除原型的属性</span><br><span class="line">delete person.hands ==&gt; <span class="literal">true</span>(这里解释一下返回<span class="literal">true</span>，因为person实例上面没有hands这个属性，删除一个不存在的属性，所以返回<span class="literal">true</span>)</span><br><span class="line">要想删除原型的属性，只能是</span><br><span class="line">delete Person.prototype.hands</span><br></pre></td></tr></table></figure>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person.hands = <span class="string">'no'</span></span><br><span class="line">这样并不能改变原型上的属性，而是给自己加了一个hands属性</span><br><span class="line">修改原型的属性，只能是</span><br><span class="line">Person.prototype.hands = <span class="string">'no'</span></span><br><span class="line">即后代不能改原型上的属性</span><br></pre></td></tr></table></figure>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>先去自己的构造函数中找，没有的话去原型上找</p>
<h2 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h2><p>构造器，person.constructor返回的是Person，那么constructor肯定不是person的属性，只能是继承过来的，所以打印原型Person.prototype看一下，里面有一个constructor，还有一个_ <em>proto</em> _</p>
<img src="/2356874721.github.io/2020/07/12/js-extend/1.png" class>
<h2 id="proto"><a href="#proto" class="headerlink" title="_ proto _"></a>_ <em>proto</em> _</h2><p>隐式的属性，系统内部的属性<br>_ <em>proto</em> _ 里面存放的就是原型Person.prototype，那么_ <em>proto</em> _ 放原型有什么用呢<br>我们知道当我们执行new Person()时，首先创建了一个空对象obj，给obj添加一个属性_ <em>proto</em> _ ，用来存放原型Person.prototype，查找属性时，先找person自己的，没有的话就会访问_ <em>proto</em> _ 这个属性，去_ <em>proto</em> _ 对应值Person.prototype上面去找，person能够找到原型的根本就在于_ <em>proto</em> _ 。<br>上述文字大致描述的就是如下的代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;</span><br><span class="line">  this.obj = &#123;&#125;</span><br><span class="line">  obj._ proto_ = Person.prototype</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面来看几个练习</p>
<h3 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a>练习1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;&#125;</span><br><span class="line">var obj = &#123;</span><br><span class="line">  name: <span class="string">'lee'</span></span><br><span class="line">&#125;</span><br><span class="line">var person = new Person()</span><br><span class="line">person.__proto__ = obj </span><br><span class="line">console.log(person.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">输出：<span class="string">'lee'</span></span><br><span class="line">分析：</span><br><span class="line">new Person()相当于在Person内部做了这两件事</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;</span><br><span class="line">  this.person = &#123;&#125;</span><br><span class="line">  person.__proto__ = Person.prototype</span><br><span class="line">&#125;</span><br><span class="line">person.__proto__ = obj 这一句之后，相当于把原型改成了obj，即：</span><br><span class="line">person.__proto__ = obj</span><br><span class="line">访问person.name时，就会找到person.__proto__指向的原型上找，所以找到了obj.name</span><br></pre></td></tr></table></figure>
<h3 id="练习2"><a href="#练习2" class="headerlink" title="练习2"></a>练习2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;&#125;</span><br><span class="line">var person = new Person()</span><br><span class="line">Person.prototype.name = <span class="string">'lee'</span></span><br><span class="line">console.log(person.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输出：<span class="string">'lee'</span></span><br><span class="line">分析：</span><br><span class="line">person.name先找自己，自己没有去找__proto__，Person.prototype.name = <span class="string">'lee'</span>把之前的值改写了</span><br></pre></td></tr></table></figure>
<h3 id="练习3"><a href="#练习3" class="headerlink" title="练习3"></a>练习3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  name: <span class="string">'lee'</span></span><br><span class="line">&#125;</span><br><span class="line">var person = new Person()</span><br><span class="line">console.log(person.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">输出：<span class="string">'lee'</span></span><br><span class="line">分析：</span><br><span class="line">  new发生了如下操作：</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;</span><br><span class="line">    this.person = &#123;&#125;</span><br><span class="line">    person.__proto__ = Person.prototype  </span><br><span class="line">  &#125;</span><br><span class="line">  Person.prototype.name = <span class="string">'sheriff'</span>被Person.prototype.name: <span class="string">'lee'</span>覆盖了</span><br><span class="line">  所以person.name输出<span class="string">'lee'</span></span><br></pre></td></tr></table></figure>
<h3 id="练习4"><a href="#练习4" class="headerlink" title="练习4"></a>练习4</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;&#125;</span><br><span class="line">var person = new Person()</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  name: <span class="string">'lee'</span></span><br><span class="line">&#125;</span><br><span class="line">console.log(person.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">输出：<span class="string">'sheriff'</span></span><br><span class="line">分析：</span><br><span class="line">  new发生了如下操作：</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;</span><br><span class="line">    this.person = &#123;&#125;</span><br><span class="line">    person.__proto__ = Person.prototype  </span><br><span class="line">  &#125;</span><br><span class="line">  Person.prototype = &#123;</span><br><span class="line">    name: <span class="string">'lee'</span></span><br><span class="line">  &#125;是发生在new之后，这会改变Person.prototype 的指向，是一个新的堆地址，而</span><br><span class="line">  person.__proto__没有变，还是原来的</span><br><span class="line">  也就是说在new之后操作原型，person.__proto__的指向已经确定了，所以还是指向最开始的<span class="string">'sheriff'</span></span><br></pre></td></tr></table></figure>
<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><p>原型链的连接点就是<strong>proto</strong>，下面看一个原型链继承的例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Grand</span></span> ()&#123;&#125;</span><br><span class="line">Grand.prototype.lastName = <span class="string">'sheriff'</span></span><br><span class="line">var grand = new Grand()</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Father</span></span>()&#123;&#125;</span><br><span class="line">Father.prototype = grand</span><br><span class="line">var father = new Father()</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Son</span></span>()&#123;&#125;</span><br><span class="line">Son.prototype = father</span><br><span class="line">var son = new Son()</span><br><span class="line">console.log(son.lastName)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输出：sheriff</span><br></pre></td></tr></table></figure>
<p>实例化对象的另一种写法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var person = new Person</span><br><span class="line">var person = Object.create(Person.prototype)</span><br></pre></td></tr></table></figure>
<p>绝大多数的对象都会继承自Object.prototype，绝大多数是什么意思，难道还有不继承Object.prototype的吗？答案是当然。<br>Object.create()创建的对象，没有参数时：</p>
<img src="/2356874721.github.io/2020/07/12/js-extend/2.png" class>
<p>因此参数必须是一个对象或者null，Object.create(null)，没有原型<strong>proto</strong>，自己往上添加是不行的，系统不识别</p>
<img src="/2356874721.github.io/2020/07/12/js-extend/3.png" class>
<h2 id="call、apply"><a href="#call、apply" class="headerlink" title="call、apply"></a>call、apply</h2><p>call和apply的作用只有一个，就是改变this指向</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">person</span></span>()&#123;&#125;</span><br><span class="line">person()</span><br><span class="line">调用函数时，底层其实是在执行person.call()</span><br></pre></td></tr></table></figure>
<h3 id="例子1"><a href="#例子1" class="headerlink" title="例子1"></a>例子1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Person(name,age)&#123;</span><br><span class="line">  this.name = name</span><br><span class="line">  this.age = age</span><br><span class="line">&#125;</span><br><span class="line">var obj = &#123;&#125;</span><br><span class="line">Person.call(obj,<span class="string">'sheriff'</span>,<span class="string">'26'</span>)</span><br><span class="line">console.log(obj)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line">  obj:&#123;</span><br><span class="line">    name: <span class="string">'sheriff'</span>,</span><br><span class="line">    age: 26</span><br><span class="line">  &#125;</span><br><span class="line">作用：借助别人的方法，完成自己的功能</span><br><span class="line">     借助Person方法，往自己身上添加属性</span><br></pre></td></tr></table></figure>
<h3 id="例子2"><a href="#例子2" class="headerlink" title="例子2"></a>例子2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Person(name,age,sex)&#123;</span><br><span class="line">  this.name = name</span><br><span class="line">  this.age = age</span><br><span class="line">  this.sex = sex</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> Student(name,age,sex,grade,num)&#123;</span><br><span class="line">  Person.call(this,name,age,sex) // 想用谁的方法，就call谁，并且把自己传进去</span><br><span class="line">  this.grade = grade</span><br><span class="line">  this.num = num</span><br><span class="line">&#125;</span><br><span class="line">var student = new Student(<span class="string">'lee'</span>,26,<span class="string">'femail'</span>,2,3016)</span><br><span class="line">console.log(student)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">输出：</span><br><span class="line">  student:&#123;</span><br><span class="line">    name: <span class="string">'lee'</span>,</span><br><span class="line">    age: 26,</span><br><span class="line">    sex: <span class="string">'femail'</span></span><br><span class="line">    grade: 2,</span><br><span class="line">    num: 3016</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>call和apply都可以改变this指向，区别是传参列表不同</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person.call(this,name,age,sex)</span><br><span class="line">Person.apply(this,[name,age,sex])</span><br></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>继承有以下几种方式：</p>
<h3 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a>原型链继承</h3><p>利用原型链可以实现继承，但是原型链继承存在的问题是继承了过多的没用的属性</p>
<h3 id="构造函数-call-apply实现继承"><a href="#构造函数-call-apply实现继承" class="headerlink" title="构造函数+call/apply实现继承"></a>构造函数+call/apply实现继承</h3><p>借用构造函数+call/apply实现继承，存在的问题有：<br>•不能继承借用的构造函数的原型<br>•每次构造函数都要多走一个函数</p>
<h3 id="组合模式-原型链-call组合模式"><a href="#组合模式-原型链-call组合模式" class="headerlink" title="组合模式(原型链+call组合模式)"></a>组合模式(原型链+call组合模式)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Father</span></span>()&#123;</span><br><span class="line">  this.age = 26</span><br><span class="line">&#125;</span><br><span class="line">Father.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Child</span></span>()&#123;</span><br><span class="line">  Father.call(this) // 继承属性，想继承谁就call谁</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = new Father() // 继承原型上的方法，此时constructor指向有问题，需修正</span><br><span class="line">Child.prototype.constructor = Child</span><br></pre></td></tr></table></figure>
<h3 id="共享原型"><a href="#共享原型" class="headerlink" title="共享原型"></a>共享原型</h3><p>Child原型和Father原型指向同一个地址空间，虽然可以继承Father的方法，但是修改Child的原型，也会影响Father原型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Father</span></span>()&#123;&#125;</span><br><span class="line">Father.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Child</span></span>()&#123;&#125;</span><br><span class="line">Child.prototype = Father.prototype</span><br><span class="line">var father = new Father()</span><br><span class="line">var child = new Child()</span><br></pre></td></tr></table></figure>
<h3 id="圣杯模式"><a href="#圣杯模式" class="headerlink" title="圣杯模式"></a>圣杯模式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> inherit(Target,Origin)&#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">Fn</span></span>()&#123;&#125;</span><br><span class="line">  Fn.prototype = Origin.prototype</span><br><span class="line">  Target.prototype = new Fn()</span><br><span class="line">  // 此时target的constructor指向Father，我们让他指向自己</span><br><span class="line">  Target.prototype.constructor = Target</span><br><span class="line">  Target.prototype.uber = Origin // 存储一下Target真正继承自哪里，有可能会用得到</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Father</span></span>()&#123;&#125;</span><br><span class="line">Father.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Child</span></span>()&#123;&#125;</span><br><span class="line">inherit(Child,Father)</span><br><span class="line">var father = new Father()</span><br><span class="line">var child = new Child()</span><br></pre></td></tr></table></figure>
<p>圣杯模式，更优雅的写法，利用闭包，使Fn成为内部函数就是return出来的函数的私有变量，只有通过这个函数才能使用，外部通过其他方法是访问不到的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var inherit = (<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="function"><span class="title">Fn</span></span>()&#123;&#125;</span><br><span class="line">  <span class="built_in">return</span> <span class="keyword">function</span>(Target,Origin)&#123;</span><br><span class="line">    Fn.prototype = Origin.prototype</span><br><span class="line">    Target.prototype = new Fn()</span><br><span class="line">    Target.prototype.constructor = Target</span><br><span class="line">    Target.prototype.uber = Origin</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Father</span></span>()&#123;&#125;</span><br><span class="line">Father.prototype.name = <span class="string">'sheriff'</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Child</span></span>()&#123;&#125;</span><br><span class="line">inherit(Child,Father)</span><br><span class="line">var father = new Father()</span><br><span class="line">var child = new Child()</span><br></pre></td></tr></table></figure>
<p>解释一下闭包变量私有化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">Person</span></span>()&#123;</span><br><span class="line">  var thing = <span class="string">'apple'</span></span><br><span class="line">  this.eat = <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    this.thing = thing</span><br><span class="line">    console.log(this.thing)</span><br><span class="line">  &#125;</span><br><span class="line">  // <span class="built_in">return</span> this 这里隐含的就是把eat方法<span class="built_in">return</span>到外部并且执行，eat是带着Person的执行上下文出去的，所以可以用Person的变量</span><br><span class="line">&#125;</span><br><span class="line">var person = new Person()</span><br><span class="line">console.log(person.eat()) // 只能通过它内部的方法来访问内部变量</span><br><span class="line">console.log(person.thing) // 直接访问变量是访问不到的</span><br></pre></td></tr></table></figure>
<h2 id="es6中的继承"><a href="#es6中的继承" class="headerlink" title="es6中的继承"></a>es6中的继承</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Father&#123;</span><br><span class="line">  constructor(name)&#123;</span><br><span class="line">    this.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">getName</span></span>()&#123;</span><br><span class="line">    console.log(this.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Child extends Father&#123;</span><br><span class="line">  constructor(name)&#123;</span><br><span class="line">    super(name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">var child = new Child(<span class="string">'sheriff'</span>)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/12/js-new-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/12/js-new-object/" class="post-title-link" itemprop="url">new发生了什么</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-12 11:56:02" itemprop="dateCreated datePublished" datetime="2020-07-12T11:56:02+08:00">2020-07-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用构造函数创建对象时，内部到底发生了什么呢？下面自己动手来实现一个new，搞清楚内部的原理。</p>
<h2 id="创建一个空对象"><a href="#创建一个空对象" class="headerlink" title="创建一个空对象"></a>创建一个空对象</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="将对象的原型指向构造函数的prototype"><a href="#将对象的原型指向构造函数的prototype" class="headerlink" title="将对象的原型指向构造函数的prototype"></a>将对象的原型指向构造函数的prototype</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.__proto__ = Fn.prototype</span><br></pre></td></tr></table></figure>
<h2 id="改变this指向"><a href="#改变this指向" class="headerlink" title="改变this指向"></a>改变this指向</h2><p>将构造函数中的this指向实例化出来的对象，并且执行构造函数，给obj加上构造函数中的属性，执行完会有一个返回值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var result = Fn.apply(obj,args)</span><br></pre></td></tr></table></figure>
<h2 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h2><p>判断构造函数的返回结果，如果有就用自己的返回，没有就用obj</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">return</span> result instanceof Object ? result : obj</span><br></pre></td></tr></table></figure>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> reNew(Fn,...args)&#123;</span><br><span class="line">  var obj = &#123;&#125;</span><br><span class="line">  obj.__proto__ = Fn.prototype</span><br><span class="line">  var result = Fn.apply(obj,args)</span><br><span class="line">  <span class="built_in">return</span> result instanceof Object ? result : obj</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> Fn(name)&#123;</span><br><span class="line">  this.name = name</span><br><span class="line">&#125;</span><br><span class="line">var fn = reNew(Fn,<span class="string">'sheriff'</span>)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/11/js-debounce-throttle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/11/js-debounce-throttle/" class="post-title-link" itemprop="url"> 防抖、节流</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-11 18:42:14" itemprop="dateCreated datePublished" datetime="2020-07-11T18:42:14+08:00">2020-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h2><p>防抖，所谓防抖，就是指触发事件后，在 n 秒内函数只能执行一次，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</p>
<h3 id="非立即执行防抖函数"><a href="#非立即执行防抖函数" class="headerlink" title="非立即执行防抖函数"></a>非立即执行防抖函数</h3><p>非立即执行防抖函数，触发事件后函数不会立即执行，而是在 n 秒后执行，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> debounce(fn,delay)&#123;</span><br><span class="line">  <span class="built_in">let</span> timeout</span><br><span class="line">  <span class="built_in">return</span> <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>(timeout) clearTimeout(timeout)</span><br><span class="line">    timeout = setTimeout(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">      fn.apply(this,arguments)</span><br><span class="line">    &#125;,delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="立即执行防抖函数"><a href="#立即执行防抖函数" class="headerlink" title="立即执行防抖函数"></a>立即执行防抖函数</h3><p>立即执行防抖函数，是指触发事件后函数会立即执行一次，然后 n 秒内不触发事件才能继续执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> debounce(fn,delay)&#123;</span><br><span class="line">  <span class="built_in">let</span> timeout</span><br><span class="line">  <span class="built_in">return</span> <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>(timeout) clearTimeout(timeout)</span><br><span class="line">    <span class="built_in">let</span> canCall = !timeout</span><br><span class="line">    timeout = setTimeout(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">      timeout = null</span><br><span class="line">    &#125;,delay)</span><br><span class="line">    <span class="keyword">if</span>(canCall)&#123;</span><br><span class="line">      fn.apply(this,arguments)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h2><p>持续触发并不会执行多次，到一定时间再去执行</p>
<h3 id="时间戳版本"><a href="#时间戳版本" class="headerlink" title="时间戳版本"></a>时间戳版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> throttle(fn,delay)&#123;</span><br><span class="line">  <span class="built_in">let</span> pre = 0</span><br><span class="line">  <span class="built_in">return</span> <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    <span class="built_in">let</span> now = Date.now()</span><br><span class="line">    <span class="keyword">if</span>(now - pre &gt; delay)&#123;</span><br><span class="line">      fn.apply(this,arguments)</span><br><span class="line">      pre = now</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定时器版本"><a href="#定时器版本" class="headerlink" title="定时器版本"></a>定时器版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> throttle(fn,delay)&#123;</span><br><span class="line">  <span class="built_in">let</span> timeout</span><br><span class="line">  <span class="built_in">return</span> <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    <span class="keyword">if</span>(!timeout)&#123;</span><br><span class="line">      timeout = setTimeout(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        timeout = null</span><br><span class="line">        fn.apply(this,arguments)</span><br><span class="line">      &#125;,delay)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/11/js-create-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/11/js-create-object/" class="post-title-link" itemprop="url">创建对象的方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-11 17:28:03" itemprop="dateCreated datePublished" datetime="2020-07-11T17:28:03+08:00">2020-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="对象字面量"><a href="#对象字面量" class="headerlink" title="对象字面量"></a>对象字面量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="new-Object"><a href="#new-Object" class="headerlink" title="new Object()"></a>new Object()</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var obj = new Object()</span><br></pre></td></tr></table></figure>
<p>上面两种方式都能创建对象，但是如果创建多个对象，会造成代码冗余，因此要封装一下，由此有了工程模式</p>
<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createObject(name,age,sex)&#123;</span><br><span class="line">  var o = &#123;&#125;</span><br><span class="line">  o.name = name</span><br><span class="line">  o.age = age</span><br><span class="line">  o.sex = sex</span><br><span class="line">  <span class="built_in">return</span> o</span><br><span class="line">&#125;</span><br><span class="line">var obj = createObject(<span class="string">'sheriff'</span>,20,<span class="string">'femail'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Person(name,age)&#123;</span><br><span class="line">  this.name = name</span><br><span class="line">  this.age = age</span><br><span class="line">  this.say = <span class="function"><span class="title">function</span></span>()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">var person = new Person()</span><br></pre></td></tr></table></figure>
<h2 id="构造函数与工厂模式的对比"><a href="#构造函数与工厂模式的对比" class="headerlink" title="构造函数与工厂模式的对比"></a>构造函数与工厂模式的对比</h2><p>优点：<br>  •构造函数没有显示的创建对象<br>  •没有return语句<br>  •可以判断对象的类型<br>缺点：每一个实例上都会创建say方法，有多少个实例，就会创建多少个，这会占用很多不必要的内存</p>
<h2 id="原型创建对象"><a href="#原型创建对象" class="headerlink" title="原型创建对象"></a>原型创建对象</h2><p>优点：方法只创建一次，所有的实例都可以用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Person(name,age)&#123;</span><br><span class="line">  this.name = name</span><br><span class="line">  this.age = age</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  say: <span class="function"><span class="title">function</span></span>()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">var person = new Person()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/11/js-scroll-bar/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/2356874721.github.io/images/avatar.gif">
      <meta itemprop="name" content="sheriff">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="警长的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2356874721.github.io/2020/07/11/js-scroll-bar/" class="post-title-link" itemprop="url">移动端滚动穿透问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-11 17:19:08" itemprop="dateCreated datePublished" datetime="2020-07-11T17:19:08+08:00">2020-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-08 23:13:03" itemprop="dateModified" datetime="2020-08-08T23:13:03+08:00">2020-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/2356874721.github.io/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>移动端，当弹窗使用fixed定位时，在弹窗上滑动，底下的背景也跟着滑动。</p>
<h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><p>当弹窗展示的时候，将底下的背景固定在当前位置，弹窗消失的时候，再清除设置。</p>
<h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">.style&#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var deepScroll = (<span class="keyword">function</span>(style)&#123;</span><br><span class="line">  var scrollTop</span><br><span class="line">  <span class="built_in">return</span> &#123;</span><br><span class="line">    beforeModal = <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">      // 获取滚动条的高度</span><br><span class="line">      scrollTop = document.scrollingElement.scrollTop || document.body.scrollTop</span><br><span class="line">      // 给body加上class 使body固定，但会使body固定在(0,0)的位置</span><br><span class="line">      document.body.classList.add(style)</span><br><span class="line">      // 把 body往上拉scrollTop的距离，使之正好固定在我们刚刚停下来的位置</span><br><span class="line">      document.body.style.top = -scrollTop + <span class="string">'px'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    afterModal = <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">      // 移除style</span><br><span class="line">      document.body.classList.remove(style)</span><br><span class="line">      // 把当前滚动条的高度设置成最开始的值</span><br><span class="line">      document.scrollingElement.scrollTop = scrollTop</span><br><span class="line">      document.body.scrollTop = scrollTop</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(<span class="string">'style'</span>))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/2356874721.github.io/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/2356874721.github.io/">1</a><span class="space">&hellip;</span><a class="page-number" href="/2356874721.github.io/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/2356874721.github.io/page/5/">5</a><a class="extend next" rel="next" href="/2356874721.github.io/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">sheriff</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/2356874721.github.io/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/2356874721.github.io/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/2356874721.github.io/tags/">
          
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sheriff</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/2356874721.github.io/lib/anime.min.js"></script>
  <script src="/2356874721.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/2356874721.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/2356874721.github.io/js/utils.js"></script>

<script src="/2356874721.github.io/js/motion.js"></script>


<script src="/2356874721.github.io/js/schemes/pisces.js"></script>


<script src="/2356874721.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
